---
title: チャットサーバーの仕様メモ
---

なんとなく考えているものをメモしている。
全部やるかはわからない。

# ユーザーについて

以下の情報を持つ。

- ユーザーID
- 接続元のIPアドレス

ユーザーIDはWebSocketの接続が確立された際にUUIDを生成して割り当て、接続が切断されるまで有効である。

# 部屋について

以下の情報を持つ。

- 部屋ID
- 参加しているユーザーのリスト

## 部屋の作成

ユーザーは部屋を作成することができる。  
作成が完了すると部屋IDが返却される。  
作成者は自動的に部屋に参加する。

```json
{
  "operation": "create_room"
}
```

すでに部屋に参加している場合はエラーが返却される。

# 部屋への参加

部屋IDを指定して部屋に参加する。

```json
{
  "operation": "join_room",
  "data": {
    "room_id": "部屋ID"
  }
}
```

指定された部屋IDの部屋が存在しない場合はエラーが返却される。

# 部屋からの退出

部屋から退出する。

```json
{
  "operation": "leave_room"
}
```

ユーザーの接続が失われた場合にも、自動的に部屋から退出する。
部屋に入っていない状態で退出しようとした場合はエラーが返却される。

## メッセージの送信

部屋に参加しているユーザーにメッセージを送信する。

```json
{
  "operation": "send_message",
  "data": {
    "text": "メッセージ"
  }
}
```

部屋に参加していない場合はエラーが返却される。

## 部屋の削除

部屋にユーザーが存在しない場合に自動的に削除される。

# 疎通確認

定期的にハートビートを送信し、返信が一定時間帰らない場合に接続を切断する。

```json
{
  "operation": "heartbeat",
  "data": {
    "session_id": "セッションID"
  }
}
```

# その他

コネクションの接続数に制限を設ける。
